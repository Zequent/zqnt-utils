syntax = "proto3";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "common.proto";

option java_multiple_files = true;
option java_package = "com.zequent.framework.services.livedata.proto";
option java_outer_classname = "LiveDataProto";
option go_package = "zequent/framework/gen/proto";


message LiveDataResponse {
  string tid = 1;
  google.protobuf.Timestamp timestamp = 2;
  bool hasErrors = 3;
  string sn = 4;
  optional string assetId = 5;
  optional string responseMessage = 6;
  oneof detail {
    AssetTelemetry assetTelemetry = 7;
    SubAssetTelemetry subAssetTelemetry = 8;
    google.protobuf.Empty empty = 9;
    GlobalErrorMessage error = 10;
    LiveStreamStartResponse liveStreamStartResponse = 11;
  }
}


message LiveDataStreamTelemetryRequest {
  RequestBase base = 1;
  optional int32 frequencyMs = 2;  // Streaming frequency
  optional int32 duration = 3; // Duration in Seconds
  LiveDataServiceCommand command = 4;
}



message ProduceTelemetryRequest {
  RequestBase base = 1;
  LiveDataType type = 2;  // ASSET_TELEMETRY or SUBASSET_TELEMETRY
  oneof telemetry {
    AssetTelemetry assetTelemetry = 3;
    SubAssetTelemetry subAssetTelemetry = 4;
    LiveStreamState liveStreamState = 5;
    GlobalErrorMessage error = 6;
  }
}

// ========== TELEMETRY RESPONSE MESSAGES ==========

message LiveDataTelemetryResponse {
  string tid = 1;
  google.protobuf.Timestamp timestamp = 2;
  bool hasErrors = 3;
  string sn = 4;
  optional string assetId = 5;
  oneof telemetry {
    AssetTelemetry assetTelemetry = 6;
    SubAssetTelemetry subAssetTelemetry = 7;
    GlobalErrorMessage error = 8;
    LiveStreamState liveStreamState = 9;
  }
}

// ========== LIVE STREAM MESSAGES ==========

message LiveStreamStartRequest {
  string videoId = 1;
  string streamServer = 2;
  LiveStreamTypeEnum streamType = 3;
  AssetTypeEnum assetType = 4;
}

message LiveStreamStopRequest {
  string videoId = 1;
}

message LiveDataStartLiveStreamRequest {
  RequestBase base = 1;
  LiveStreamStartRequest request = 2;
}

message LiveDataStopLiveStreamRequest {
  RequestBase base = 1;
  LiveStreamStopRequest request = 2;
}

message LiveDataChangeLensRequest{
  RequestBase base = 1;
  ChangeCameraLensRequest request = 2;
}

message LiveDataChangeZoomRequest{
  RequestBase base = 1;
  ChangeCameraZoomRequest request = 2;
}

message LiveDataStartRecordingRequest{
  RequestBase base = 1;
}

message LiveDataStopRecordingRequest{
  RequestBase base = 1;
}

message LiveDataCapturePhotoRequest{
  RequestBase base = 1;
}

message AssetPropertiesProto{
  bool detectionEnabled = 1;
  bool trackingEnabled = 2;
}

message AssetTelemetry{
  string id = 1;
  google.protobuf.Timestamp timestamp = 2;
  optional float latitude = 3;
  optional float longitude = 4;
  optional float absoluteAltitude = 5;
  optional float relativeAltitude = 6;
  optional float environmentTemp = 7;
  optional float insideTemp = 8;
  optional float humidity = 9;
  optional AssetModes mode = 10;
  optional RainfallEnum rainfall = 11;
  optional AssetSubAssetInformation subAssetInformation = 12;
  optional bool subAssetAtHome = 13;
  optional bool subAssetCharging = 14;
  optional float subAssetPercentage = 15;
  optional float heading = 16;
  optional bool debugModeOpen = 17;
  optional bool hasActiveManualControlSession = 18;
  optional AssetCoverStateEnum coverState = 19;
  optional int32 workingVoltage = 20;
  optional int32 workingCurrent = 21;
  optional int32 supplyVoltage = 22;
  optional float windSpeed = 23;
  optional bool positionValid = 24;
  optional AssetNetworkInformation networkInformation = 25;
  optional AssetAirConditioner airConditioner = 26;
  optional ManualControlStateEnum manualControlState = 27;
  optional PositionState positionState = 28;


  message PositionState{
    optional int32 gpsNumber = 1;
    optional int32 rtkNumber = 2;
    optional int32 quality = 3;
  }


  message AssetAirConditioner{
    optional AssetAirConditionerStateEnum state = 1;
    optional int32 switchTime = 2;
  }
  message AssetNetworkInformation {
    optional NetworkTypeEnum type = 1;
    optional float rate = 2;
    optional NetworkStateQualityEnum quality = 3;

  }
  message AssetSubAssetInformation{
    optional string sn = 1;
    optional string model = 2;
    optional bool paired = 3;
    optional bool online = 4;
  }
}


message SubAssetTelemetry {
  string id = 1;
  google.protobuf.Timestamp timestamp = 2;
  optional float latitude = 3;
  optional float longitude = 4;
  optional float absoluteAltitude = 5;
  optional float relativeAltitude = 6;
  optional float horizontalSpeed = 7;
  optional float verticalSpeed = 8;
  optional float windSpeed = 9;
  optional string windDirection = 10;
  optional float heading = 11;
  optional int32 gear = 12;
  optional PayloadTelemetry payloadTelemetry = 13;
  optional SubAssetBatteryInformation batteryInformation = 14;
  optional int32 heightLimit = 15;
  optional float homeDistance = 16;
  optional double totalMovementDistance = 17;
  optional double totalMovementTime = 18;
  optional SubAssetMode mode = 19;
  optional string country = 20;



  message SubAssetBatteryInformation{
    optional string percentage = 1;
    optional int32 remainingTime = 2;
    optional string returnToHomePower = 3;
  }

}



message PayloadTelemetry {
  string id = 1;
  google.protobuf.Timestamp timestamp = 2;
  optional CameraData cameraData = 3;
  optional RangeFinderData rangeFinderData = 4;
  optional SensorData sensorData = 5;
  string name = 6;



  message CameraData{
    optional string currentLens = 1;
    optional float gimbalPitch = 2;
    optional float gimbalYaw = 3;
    optional float zoomFactor = 4;
    optional float gimbalRoll = 5;
  }

  message RangeFinderData{

    optional float targetLatitude = 1;
    optional float targetLongitude = 2;
    optional float targetDistance = 3;
    optional float targetAltitude = 4;
  }

  message SensorData{
    optional float targetTemperature = 1;
  }
}

// ========== SERVICE ==========

service LiveDataService {
  // Telemetry Streaming - Server sends telemetry to clients
  rpc StreamTelemetry(LiveDataStreamTelemetryRequest) returns (stream LiveDataTelemetryResponse);

  // Telemetry Production - Clients (Edge adapters) send telemetry to server
  rpc ProduceTelemetry(stream ProduceTelemetryRequest) returns (LiveDataResponse);

  // Live Stream Management
  rpc StartLiveStream(LiveDataStartLiveStreamRequest) returns (LiveDataResponse);
  rpc StopLiveStream(LiveDataStopLiveStreamRequest) returns (LiveDataResponse);
  rpc ChangeLens(LiveDataChangeLensRequest) returns (LiveDataResponse);
  rpc ChangeZoom(LiveDataChangeZoomRequest) returns (LiveDataResponse);

  rpc StartRecording(LiveDataStartRecordingRequest) returns (LiveDataResponse);
  rpc StopRecording(LiveDataStopRecordingRequest) returns (LiveDataResponse);
  rpc CapturePhoto(LiveDataCapturePhotoRequest) returns (LiveDataResponse);
}

